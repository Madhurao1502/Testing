<div class="tree-container">
  <tree-root
    [nodes]="nodes"
    [options]="treeOptions"
    (activate)="onNodeActivate($event)"
    (toggleCheckbox)="onNodeCheck($event)">
    <ng-template #treeNodeTemplate let-node let-index="index">
      <div class="tree-node-content">
        <!-- Checkbox (controlled by Angular, not Tree's default ckb) -->
        <input
          type="checkbox"
          [checked]="node.data.checked"
          [disabled]="node.data.disabled || disabled"
          (change)="onNodeCheckDirect(node)"
          class="node-checkbox"
        >

        <!-- Node Name -->
        <span class="node-name" [class.disabled]="node.data.disabled || disabled" (click)="onNodeActivateDirect(node)">
          {{ node.data.name }}
        </span>

        <!-- Select All Children Action -->
        <button
          *ngIf="node.data.children?.length && !disabled && !node.data.disabled"
          mat-button
          class="select-all-btn"
          (click)="onSelectAllChildren(node.data); $event.stopPropagation()"
        >
          <b>(Select all Child variables)</b>
        </button>

        <!-- Custom Input for Other Section Width -->
        <div *ngIf="isOtherSectionWidth(node.data) && node.data.checked" class="custom-input-container">
          <mat-form-field appearance="outline" class="custom-input">
            <mat-label>Min</mat-label>
            <input
              matInput
              type="number"
              [value]="node.data.taskMin"
              (input)="onCustomInputChange(node.data, 'taskMin', $event.target.value)"
              [disabled]="disabled"
              [min]="node.data.mainMin"
              [max]="node.data.mainMax"
            >
          </mat-form-field>
          <mat-form-field appearance="outline" class="custom-input">
            <mat-label>Max</mat-label>
            <input
              matInput
              type="number"
              [value]="node.data.taskMax"
              (input)="onCustomInputChange(node.data, 'taskMax', $event.target.value)"
              [disabled]="disabled"
              [min]="node.data.mainMin"
              [max]="node.data.mainMax"
            >
          </mat-form-field>
        </div>

        <!-- Custom Input for Other Height -->
        <div *ngIf="isOtherHeight(node.data) && node.data.checked" class="custom-input-container">
          <mat-form-field appearance="outline" class="custom-input">
            <mat-label>Min</mat-label>
            <input
              matInput
              type="number"
              [value]="node.data.taskMin"
              (input)="onCustomInputChange(node.data, 'taskMin', $event.target.value)"
              [disabled]="disabled"
              [min]="node.data.mainMin"
              [max]="node.data.mainMax"
            >
          </mat-form-field>
          <mat-form-field appearance="outline" class="custom-input">
            <mat-label>Max</mat-label>
            <input
              matInput
              type="number"
              [value]="node.data.taskMax"
              (input)="onCustomInputChange(node.data, 'taskMax', $event.target.value)"
              [disabled]="disabled"
              [min]="node.data.mainMin"
              [max]="node.data.mainMax"
            >
          </mat-form-field>
        </div>
      </div>
    </ng-template>
  </tree-root>
</div>
