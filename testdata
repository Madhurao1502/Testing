confirmDialog(): void {
  if (this.dialogMode === 'add' && this.rightClickedNode) {
    const parent = this.rightClickedNode;
    parent.children = parent.children || [];
    // Find max mainOrdinal for sequential insert
    let maxOrdinal = 0;
    if (parent.children.length) {
      maxOrdinal = Math.max(...parent.children.map(c => Number(c.MainOrdinal || c.mainOrdinal || 0)));
    }
    const newNode: ShelfNode = {
      Id: this.generateNewNodeId(parent), // your helper
      PId: parent.Id,
      Name: this.dialogNodeName.trim(),
      optional: 'Y',
      IsNewlyAdded: 'N',
      MainOrdinal: maxOrdinal + 1,
      children: []
    };
    parent.children.push(newNode);
    this.sortChildrenByOrdinal(parent);
    this.treeControl.expand(parent);
    this.dataSource.data = this.dataSource.data.slice(); // Ensures tree refresh
  }
  // ...rest of confirmDialog for edit
  this.showDialog = false;
}
