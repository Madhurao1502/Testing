private applyParentRowPagination(): void {
  if (!this.paginator) return;

  this.forceCollapseAllRows();
  this.resetExpansionState();

  const pageIndex = this.paginator.pageIndex;
  const pageSize = this.paginator.pageSize;

  // Get ONLY parent rows - never count child rows for pagination
  const allParentRows = this.parentRowsData.filter(row => !row.isChildRow);
  
  // Calculate pagination based on PARENT rows only
  const startIndex = pageIndex * pageSize;
  const endIndex = startIndex + pageSize;
  
  // Get parent rows for current page (NO CHILD ROWS)
  const currentPageParentRows = allParentRows.slice(startIndex, endIndex);
  
  // Update datasource with ONLY parent rows for current page
  this.dataSource.data = currentPageParentRows;
  
  // ✅ CRITICAL: Set paginator length to ONLY parent rows count
  this.paginator.length = allParentRows.length;  // Should be 5000, not 50!
  
  this.cdr.detectChanges();
}

private updatePaginatorLength(): void {
  if (!this.paginator) return;
  
  // ✅ Count ONLY parent rows - NEVER include child rows
  const parentRowCount = this.parentRowsData.filter(row => !row.isChildRow).length;
  this.paginator.length = parentRowCount;
  
  console.log('Paginator length updated to:', parentRowCount);
}


private resetExpansionState(): void {
  this.allExpanded = false;
  this.isExpandingAll = false;
  this.expandedRows.clear();
  this.selectedRows.clear();
  this.childRowsMap.clear();  // ← Also clear child rows map
  
  // Keep ONLY parent rows in datasource
  const parentRowsOnly = this.dataSource.data.filter(row => !row.isChildRow);
  this.dataSource.data = parentRowsOnly;
  this.updatePaginatorLength();
  this.cdr.detectChanges();
}
